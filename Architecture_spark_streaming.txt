Spark Streaming Setup:

- The start_streaming function reads data from a socket.
- Define the schema for the incoming data.
- Parse the incoming JSON data using the defined schema.
- Perform sentiment analysis on the incoming text data.
- Write the processed data back to Kafka.

+-------------------------------+               +-------------------------------+
|          Start                |               |     Exception encountered?    |
+-------------------------------+               +-------------------------------+
                  |                                 /                   \
                  v                                /                     \
+-------------------------------+      Yes      /       No               \
|     Create Spark session      +<-------------/                         |
+-------------------------------+                                         |
                  |                                                      |
                  v                                                      |
+-------------------------------+                                         |
|       Start streaming         +-----------------------------------------+
+-------------------------------+                                         |
                  |                                                      |
                  v                                                      |
+-------------------------------+                                         |
|    Read data from socket      +-----------------------------------------+
+-------------------------------+                                         |
                  |                                                      |
                  v                                                      |
+-------------------------------+                                         |
|     Define schema for data    +-----------------------------------------+
+-------------------------------+                                         |
                  |                                                      |
                  v                                                      |
+-------------------------------+                                         |
|  Parse JSON data to DataFrame +-----------------------------------------+
+-------------------------------+                                         |
                  |                                                      |
                  v                                                      |
+-------------------------------+                                         |
| Perform sentiment analysis    +-----------------------------------------+
|    using OpenAI API           |                                         |
+-------------------------------+                                         |
                  |                                                      |
                  v                                                      |
+-------------------------------+                                         |
|  Update DataFrame with        +-----------------------------------------+
|    sentiment results          |                                         |
+-------------------------------+                                         |
                  |                                                      |
                  v                                                      |
+-------------------------------+                                         |
| Write processed data to Kafka +-----------------------------------------+
+-------------------------------+                                         |
                  |                                                      |
                  v                                                      |
+-------------------------------+                                         |
|    Handle exceptions          +-----------------------------------------+
+-------------------------------+                                         |
                  |                                                      |
                  v                                                      |
+-------------------------------+                                         |
|     Wait and retry            +-----------------------------------------+
+-------------------------------+                                         |
                  |                                                      |
                  v                                                      |
+-------------------------------+                                         |
|           End                 |                                         |
+-------------------------------+                                         |